# Public CMS Experience

## Purpose

Define the front-of-house content experience that surfaces curated media assets to end users. The public CMS experience consumes APIs from Logic Router and Search, integrates with Authentik for protected content, and coordinates publishing workflows originating from the internal CMS (`01_conf_mgmt/content-management.md`).

## Audience & Requirements

- Primary users: external visitors consuming localized knowledge-base content and media.
- Support authenticated experiences (member-only collections, moderation dashboards).
- Provide fast page loads, accessible design (WCAG 2.1 AA), and localization (Persian, English, others as needed).
- Honor publishing windows and takedowns propagated through Kafka events and Logic Router APIs.

## Architecture

| Layer          | Responsibility                                                                          | References                                                                       |
| -------------- | --------------------------------------------------------------------------------------- | -------------------------------------------------------------------------------- |
| Static Shell   | React/Next.js SPA or SSR delivering layout, routing, localization                       | Hosted via CDN (Cloudflare) or edge platform                                     |
| Data Fetch     | Calls Logic Router (`/api/v1/...`), Search API, and PostgREST proxied endpoints         | `51_Presentation_back/logic-router.md`, `23_search_back/search-elasticsearch.md` |
| Auth           | Authentik integration via OAuth/OIDC (PKCE) and session tokens stored in secure cookies | `11_athentik_user/authentication.md`                                             |
| Asset Delivery | Uses signed URLs generated by Logic Router/MinIO control                                | `21_content_manager/minio-content-server.md`                                     |
| Analytics      | Captures engagement metrics, search usage, error tracking (Sentry)                      | Collected in analytics pipeline (future)                                         |

## Deployment Model

- Source in `52_Presentation_front` (see `52_Presentation_front/frontend-app.md`).
- Build pipeline: Node.js 20, `npm ci`, `npm run build`, unit tests and linting enforced (`eslint`, `jest`).
- Artifacts deployed to CDN via GitHub Actions + GitOps; preview environments enabled per PR.
- Environment configuration (API endpoints, feature flags) injected at build time via `config-cli` or environment variables.

## Localization Workflow

1. CMS publishes localized content with translation metadata.
2. Front-end fetches localized payloads; fallback sequence defined (e.g., `fa-IR` -> `fa` -> `en`).
3. Static strings managed via i18n bundles; dynamic content from Logic Router includes locale metadata.
4. QA checklists ensure layout accommodates right-to-left languages.

## Caching Strategy

- CDN caches static assets (HTML/JS/CSS) with cache busting via content hashes.
- API responses cached where safe (e.g., public articles) using `stale-while-revalidate`.
- Signed URLs remain short-lived; front-end handles refresh gracefully.
- Service worker optional for offline support of select pages.

## Security & Compliance

- Enforce HTTPS, Content Security Policy, and strict SameSite cookies.
- Use Authentik for login flows; no passwords stored client-side.
- Respect takedown signals by clearing cached data and reacting to `media.asset_revoked.v1` via API.
- Implement consent management if analytics or third-party embeds introduced.

## Observability

- Front-end telemetry: performance metrics (LCP, TTFB) via browser APIs, error logging with Sentry/New Relic.
- Link to backend tracing by forwarding correlation IDs from Logic Router responses.
- Dashboard displays pageview trends, search usage, and auth conversion.
- Alerts for error rate spikes, API latency from client perspective.

## Roadmap

1. Phase 1: Launch localized knowledge base with authenticated sections.
2. Phase 2: Add media galleries, advanced search filters, and personalization hooks.
3. Phase 3: Integrate real-time updates (WebSockets or SSE) for live content.
4. Phase 4: Mobile apps or PWA enhancements, A/B testing framework.

## References

- `51_Presentation_back/logic-router.md`
- `23_search_back/search-elasticsearch.md`
- `21_content_manager/minio-content-server.md`
- `docs/events/event-catalog.md`
- `SystemReqs.md`
